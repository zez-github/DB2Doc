<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据库关系图 - DB2Doc</title>
    <link href="{{ url_for('static', filename='lib/bootstrap/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='lib/fontawesome/css/all.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="w-100 h-100" id="diagramRoot">
        <div class="bg-light border-bottom p-3" id="diagramHeader">
            <div class="d-flex justify-content-between align-items-center gap-3">
                <div class="flex-grow-1">
                    <h1 class="h4 mb-0">
                        <i class="fas fa-project-diagram text-primary"></i>
                        数据库关系图
                    </h1>
                    <div class="small text-muted mt-1 d-flex align-items-center gap-2">
                        <i class="fas fa-plug"></i>
                        <span id="diagramConnectionSummary">未连接到任何数据库</span>
                    </div>
                </div>
                <div class="btn-group flex-shrink-0">
                    <a class="btn btn-outline-secondary" href="/" title="返回文档工作台">
                        <i class="fas fa-arrow-left"></i> 返回
                    </a>
                    <button type="button" class="btn btn-outline-primary" id="diagramReloadBtn" title="重新加载关系图">
                        <i class="fas fa-sync-alt"></i> 刷新
                    </button>
                    <button type="button" class="btn btn-outline-success" id="diagramExportPngBtn" title="导出为 PNG 图片">
                        <i class="fas fa-file-image"></i> 导出PNG
                    </button>
                </div>
            </div>

            <div class="mt-3">
                <div class="row g-2 align-items-center">
                    <div class="col-md-4">
                        <input type="text" class="form-control form-control-sm" id="diagramSearch" placeholder="搜索表名...">
                    </div>
                    <div class="col-md-2">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="diagramShowInferred" checked>
                            <label class="form-check-label small" for="diagramShowInferred">推断关系</label>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="diagramUseLLM">
                            <label class="form-check-label small" for="diagramUseLLM">
                                <i class="fas fa-brain text-purple"></i> LLM
                            </label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="d-flex align-items-center gap-2">
                            <span class="small text-muted">推断阈值</span>
                            <input type="range" class="form-range" id="diagramThreshold" min="0" max="1" step="0.05" value="0.6">
                            <span class="badge bg-secondary" id="diagramThresholdValue">0.60</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid p-0 d-flex position-relative" id="diagramBody" style="height: calc(100vh - 150px); overflow: hidden;">
            <!-- 左侧：关系图区域 -->
            <div class="bg-white position-relative flex-grow-1" id="diagramCanvasWrapper">
                <div id="cy" class="diagram-canvas" style="overflow: hidden; cursor: grab; width: 100%; height: 100%;"></div>
                <!-- 缩放控制按钮 -->
                <div class="position-absolute bottom-0 end-0 m-3 btn-group-vertical" style="z-index: 100;">
                    <button class="btn btn-sm btn-light border" id="zoomInBtn" title="放大">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="btn btn-sm btn-light border" id="zoomResetBtn" title="重置缩放">
                        <i class="fas fa-compress"></i>
                    </button>
                    <button class="btn btn-sm btn-light border" id="zoomOutBtn" title="缩小">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
                <!-- 统计信息和缩放比例 -->
                <div class="position-absolute bottom-0 start-0 m-3 d-flex gap-2" style="z-index: 100;">
                    <span class="badge bg-secondary" id="zoomLevel">100%</span>
                    <span class="badge bg-primary" id="diagramStats"></span>
                </div>
            </div>
            
            <!-- 右侧：表详情面板（默认隐藏） -->
            <div class="table-detail-panel" id="tableDetailPanel">
                <div class="table-detail-header">
                    <div class="d-flex align-items-center gap-2">
                        <i class="fas fa-table text-primary"></i>
                        <span class="fw-semibold" id="detailTableName">表名</span>
                        <span class="badge bg-warning text-dark ms-auto" id="detailCoreBadge" style="display: none;">核心表</span>
                        <span class="badge bg-secondary ms-1" id="detailIsolatedBadge" style="display: none;">孤立表</span>
                    </div>
                    <button class="btn btn-sm btn-link text-muted p-0" id="closeDetailPanel" title="关闭">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="table-detail-comment" id="detailTableComment"></div>
                <div class="table-detail-stats" id="detailTableStats"></div>
                
                <!-- 字段列表 -->
                <div class="table-detail-section">
                    <div class="table-detail-section-title">
                        <i class="fas fa-columns"></i> 字段列表 <span class="text-muted" id="detailColumnsCount"></span>
                    </div>
                    <div class="table-detail-columns" id="detailColumnsList"></div>
                </div>
                
                <!-- 关联关系 -->
                <div class="table-detail-section">
                    <div class="table-detail-section-title">
                        <i class="fas fa-link"></i> 关联关系 <span class="text-muted" id="detailRelationsCount"></span>
                    </div>
                    <div class="table-detail-relations" id="detailRelationsList"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='lib/bootstrap/bootstrap.bundle.min.js') }}"></script>
    <!-- Mermaid.js 用于渲染 ER 图 -->
    <script src="{{ url_for('static', filename='js/mermaid.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/diagram.js') }}"></script>
</body>
</html>


